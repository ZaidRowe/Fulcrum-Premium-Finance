{"version":3,"sources":["matrix/src/MatrixInput.js"],"names":["$","Craft","MatrixInput","Garnish","Base","extend","blockTypes","blockTypesByHandle","inputNamePrefix","showingAddBlockMenu","addBlockBtnGroupWidth","addBlockBtnContainerWidth","$blockContainer","$addBlockBtnContainer","$addBlockBtnGroup","$addBlockBtnGroupBtns","blockSort","totalNewBlocks","blockSelect","id","settings","i","collapsedBlocks","inputIdPrefix","this","formatInputId","maxBlocks","$container","setSettings","defaults","children","$addBlockMenuBtn","setNewBlockBtn","data","handle","getCollapsedBlockIds","blockType","DragSort","$blocks","$targetItem","hasClass","axis","filter","proxy","getSelectedItems","resetItemOrder","Select","magnetStrength","helperLagBase","helperOpacity","onSortChange","blockId","multi","vertical","checkboxMode","length","MatrixBlock","$block","newMatch","match","block","inArray","option","collapse","updateAddBlockBtn","ev","addListener","type","ready","MenuBtn","addBlock","width","requestAnimationFrame","addClass","removeClass","navigator","userAgent","indexOf","css","$items","canAddMoreBlocks","$actionMenu","eq","find","parent","getBlockTypeByHandle","$insertBefore","staticBlocks","html","name","t","getParsedBlockHtml","getHiddenBlockCss","velocity","draftEditor","addItems","pause","insertBefore","appendTo","window","bodyHtml","footHtml","$fieldsContainer","trigger","collapseSelectedBlocks","callOnSelectedBlocks","expandSelectedBlocks","append","initUiElements","disableSelectedBlocks","enableSelectedBlocks","scrollContainerToElement","resume","marginBottom","replace","filterArray","localStorage","deleteSelectedBlocks","fn","rememberCollapsedBlockId","$selectedItems","Storage","opacity","outerHeight","collapsedBlocksIndex","RegExp","placeholderKey","$titlebar","$previewContainer","$collapsedInput","collapsed","systemUid","matrix","collapsedBlockStorageKey","split","menuBtn","$menuBtn","menu","ids","join","push","setCollapsedBlockIds","forgetCollapsedBlockId","splice","hasAttr","isNew","init","previewHtml","$fields","$inputs","substr","value","$maybeLightswitchContainer","$input","on","text","prev","next","inputPreviewText","_handleTitleBarClick","preventDefault","expand","animate","j","val","getText","getInputPostVal","Array","show","hide","duration","height","setTimeout","$prev","onMenuOptionSelect","batchAction","totalSelected","$option","collapsedContainerHeight","display","displayValue","expandedContainerHeight","disable","enable","moveUp","moveDown","$next","insertAfter","isSelected","remove","confirm","selfDestruct","jQuery"],"mappings":"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","file":"MatrixInput.min.js","sourcesContent":["(function($) {\n    /** global: Craft */\n    /** global: Garnish */\n    /**\n     * Matrix input class\n     */\n    Craft.MatrixInput = Garnish.Base.extend(\n        {\n            id: null,\n            blockTypes: null,\n            blockTypesByHandle: null,\n            inputNamePrefix: null,\n            inputIdPrefix: null,\n\n            showingAddBlockMenu: false,\n            addBlockBtnGroupWidth: null,\n            addBlockBtnContainerWidth: null,\n\n            $container: null,\n            $blockContainer: null,\n            $addBlockBtnContainer: null,\n            $addBlockBtnGroup: null,\n            $addBlockBtnGroupBtns: null,\n\n            blockSort: null,\n            blockSelect: null,\n            totalNewBlocks: 0,\n\n            init: function(id, blockTypes, inputNamePrefix, settings) {\n                this.id = id;\n                this.blockTypes = blockTypes;\n                this.inputNamePrefix = inputNamePrefix;\n                this.inputIdPrefix = Craft.formatInputId(this.inputNamePrefix);\n\n                // see if settings was actually set to the maxBlocks value\n                if (typeof settings === 'number') {\n                    settings = {maxBlocks: settings};\n                }\n                this.setSettings(settings, Craft.MatrixInput.defaults);\n\n                this.$container = $('#' + this.id);\n                this.$blockContainer = this.$container.children('.blocks');\n                this.$addBlockBtnContainer = this.$container.children('.buttons');\n                this.$addBlockBtnGroup = this.$addBlockBtnContainer.children('.btngroup');\n                this.$addBlockBtnGroupBtns = this.$addBlockBtnGroup.children('.btn');\n                this.$addBlockMenuBtn = this.$addBlockBtnContainer.children('.menubtn');\n\n                this.$container.data('matrix', this);\n\n                this.setNewBlockBtn();\n\n                this.blockTypesByHandle = {};\n\n                var i;\n\n                for (i = 0; i < this.blockTypes.length; i++) {\n                    var blockType = this.blockTypes[i];\n                    this.blockTypesByHandle[blockType.handle] = blockType;\n                }\n\n                var $blocks = this.$blockContainer.children(),\n                    collapsedBlocks = Craft.MatrixInput.getCollapsedBlockIds();\n\n                this.blockSort = new Garnish.DragSort($blocks, {\n                    handle: '> .actions > .move',\n                    axis: 'y',\n                    filter: $.proxy(function() {\n                        // Only return all the selected items if the target item is selected\n                        if (this.blockSort.$targetItem.hasClass('sel')) {\n                            return this.blockSelect.getSelectedItems();\n                        }\n                        else {\n                            return this.blockSort.$targetItem;\n                        }\n                    }, this),\n                    collapseDraggees: true,\n                    magnetStrength: 4,\n                    helperLagBase: 1.5,\n                    helperOpacity: 0.9,\n                    onSortChange: $.proxy(function() {\n                        this.blockSelect.resetItemOrder();\n                    }, this)\n                });\n\n                this.blockSelect = new Garnish.Select(this.$blockContainer, $blocks, {\n                    multi: true,\n                    vertical: true,\n                    handle: '> .checkbox, > .titlebar',\n                    checkboxMode: true\n                });\n\n                for (i = 0; i < $blocks.length; i++) {\n                    var $block = $($blocks[i]),\n                        blockId = $block.data('id');\n\n                    // Is this a new block?\n                    var newMatch = (typeof blockId === 'string' && blockId.match(/new(\\d+)/));\n\n                    if (newMatch && newMatch[1] > this.totalNewBlocks) {\n                        this.totalNewBlocks = parseInt(newMatch[1]);\n                    }\n\n                    var block = new MatrixBlock(this, $block);\n\n                    if (block.id && $.inArray('' + block.id, collapsedBlocks) !== -1) {\n                        block.collapse();\n                    }\n                }\n\n                this.addListener(this.$addBlockBtnGroupBtns, 'click', function(ev) {\n                    var type = $(ev.target).data('type');\n                    this.addBlock(type);\n                });\n\n                new Garnish.MenuBtn(this.$addBlockMenuBtn,\n                    {\n                        onOptionSelect: $.proxy(function(option) {\n                            var type = $(option).data('type');\n                            this.addBlock(type);\n                        }, this)\n                    });\n\n                this.updateAddBlockBtn();\n\n                this.addListener(this.$container, 'resize', 'setNewBlockBtn');\n                Garnish.$doc.ready($.proxy(this, 'setNewBlockBtn'));\n\n                this.trigger('afterInit');\n            },\n\n            setNewBlockBtn: function() {\n                // Do we know what the button group width is yet?\n                if (!this.addBlockBtnGroupWidth) {\n                    this.addBlockBtnGroupWidth = this.$addBlockBtnGroup.width();\n\n                    if (!this.addBlockBtnGroupWidth) {\n                        return;\n                    }\n                }\n\n                // Only check if the container width has resized\n                if (this.addBlockBtnContainerWidth !== (this.addBlockBtnContainerWidth = this.$addBlockBtnContainer.width())) {\n                    if (this.addBlockBtnGroupWidth > this.addBlockBtnContainerWidth) {\n                        if (!this.showingAddBlockMenu) {\n                            this.$addBlockBtnGroup.addClass('hidden');\n                            this.$addBlockMenuBtn.removeClass('hidden');\n                            this.showingAddBlockMenu = true;\n                        }\n                    }\n                    else {\n                        if (this.showingAddBlockMenu) {\n                            this.$addBlockMenuBtn.addClass('hidden');\n                            this.$addBlockBtnGroup.removeClass('hidden');\n                            this.showingAddBlockMenu = false;\n\n                            // Because Safari is awesome\n                            if (navigator.userAgent.indexOf('Safari') !== -1) {\n                                Garnish.requestAnimationFrame($.proxy(function() {\n                                    this.$addBlockBtnGroup.css('opacity', 0.99);\n\n                                    Garnish.requestAnimationFrame($.proxy(function() {\n                                        this.$addBlockBtnGroup.css('opacity', '');\n                                    }, this));\n                                }, this));\n                            }\n                        }\n                    }\n                }\n            },\n\n            canAddMoreBlocks: function() {\n                return (!this.maxBlocks || this.$blockContainer.children().length < this.maxBlocks);\n            },\n\n            updateAddBlockBtn: function() {\n                var i, block;\n\n                if (this.canAddMoreBlocks()) {\n                    this.$addBlockBtnGroup.removeClass('disabled');\n                    this.$addBlockMenuBtn.removeClass('disabled');\n\n                    for (i = 0; i < this.blockSelect.$items.length; i++) {\n                        block = this.blockSelect.$items.eq(i).data('block');\n\n                        if (block) {\n                            block.$actionMenu.find('a[data-action=add]').parent().removeClass('disabled');\n                        }\n                    }\n                }\n                else {\n                    this.$addBlockBtnGroup.addClass('disabled');\n                    this.$addBlockMenuBtn.addClass('disabled');\n\n                    for (i = 0; i < this.blockSelect.$items.length; i++) {\n                        block = this.blockSelect.$items.eq(i).data('block');\n\n                        if (block) {\n                            block.$actionMenu.find('a[data-action=add]').parent().addClass('disabled');\n                        }\n                    }\n                }\n            },\n\n            addBlock: function(type, $insertBefore) {\n                if (!this.canAddMoreBlocks()) {\n                    return;\n                }\n\n                this.totalNewBlocks++;\n\n                var id = 'new' + this.totalNewBlocks;\n\n                var html = `\n<div class=\"matrixblock\" data-id=\"${id}\" data-type=\"${type}\">\n  <input type=\"hidden\" name=\"${this.inputNamePrefix}[sortOrder][]\" value=\"${id}\"/>\n  <input type=\"hidden\" name=\"${this.inputNamePrefix}[blocks][${id}][type]\" value=\"${type}\"/>\n  <input type=\"hidden\" name=\"${this.inputNamePrefix}[blocks][${id}][enabled]\" value=\"1\"/>\n  <div class=\"titlebar\">\n    <div class=\"blocktype\">${this.getBlockTypeByHandle(type).name}</div>\n    <div class=\"preview\"></div>\n  </div>\n  <div class=\"checkbox\" title=\"${Craft.t('app', 'Select')}\"></div>\n  <div class=\"actions\">\n    <div class=\"status off\" title=\"${Craft.t('app', 'Disabled')}\"></div>\n    <a class=\"settings icon menubtn\" title=\"${Craft.t('app', 'Actions')}\" role=\"button\"></a> \n    <div class=\"menu\">\n      <ul class=\"padded\">\n        <li><a data-icon=\"collapse\" data-action=\"collapse\">${Craft.t('app', 'Collapse')}</a></li>\n        <li class=\"hidden\"><a data-icon=\"expand\" data-action=\"expand\">${Craft.t('app', 'Expand')}</a></li>\n        <li><a data-icon=\"disabled\" data-action=\"disable\">${Craft.t('app', 'Disable')}</a></li>\n        <li class=\"hidden\"><a data-icon=\"enabled\" data-action=\"enable\">${Craft.t('app', 'Enable')}</a></li>\n        <li><a data-icon=\"uarr\" data-action=\"moveUp\">${Craft.t('app', 'Move up')}</a></li>\n        <li><a data-icon=\"darr\" data-action=\"moveDown\">${Craft.t('app', 'Move down')}</a></li>\n      </ul>`;\n\n                if (!this.settings.staticBlocks) {\n                    html += `\n      <hr class=\"padded\"/>\n      <ul class=\"padded\">\n        <li><a class=\"error\" data-icon=\"remove\" data-action=\"delete\">${Craft.t('app', 'Delete')}</a></li>\n      </ul>\n      <hr class=\"padded\"/>\n      <ul class=\"padded\">`;\n\n                    for (var i = 0; i < this.blockTypes.length; i++) {\n                        var blockType = this.blockTypes[i];\n                        html += `\n        <li><a data-icon=\"plus\" data-action=\"add\" data-type=\"${blockType.handle}\">${Craft.t('app', 'Add {type} above', {type: blockType.name})}</a></li>`;\n                    }\n\n                    html += `\n      </ul>`\n                }\n\n                html += `\n    </div>\n    <a class=\"move icon\" title=\"${Craft.t('app', 'Reorder')}\" role=\"button\"></a>\n  </div>\n</div>`;\n\n                var $block = $(html);\n\n                // Pause the draft editor\n                if (window.draftEditor) {\n                    window.draftEditor.pause();\n                }\n\n                if ($insertBefore) {\n                    $block.insertBefore($insertBefore);\n                }\n                else {\n                    $block.appendTo(this.$blockContainer);\n                }\n\n                var $fieldsContainer = $('<div class=\"fields\"/>').appendTo($block),\n                    bodyHtml = this.getParsedBlockHtml(this.blockTypesByHandle[type].bodyHtml, id),\n                    footHtml = this.getParsedBlockHtml(this.blockTypesByHandle[type].footHtml, id);\n\n                $(bodyHtml).appendTo($fieldsContainer);\n\n                this.trigger('blockAdded', {\n                    $block: $block\n                });\n\n                // Animate the block into position\n                $block.css(this.getHiddenBlockCss($block)).velocity({\n                    opacity: 1,\n                    'margin-bottom': 10\n                }, 'fast', $.proxy(function() {\n                    $block.css('margin-bottom', '');\n                    Garnish.$bod.append(footHtml);\n                    Craft.initUiElements($fieldsContainer);\n                    new MatrixBlock(this, $block);\n                    this.blockSort.addItems($block);\n                    this.blockSelect.addItems($block);\n                    this.updateAddBlockBtn();\n\n                    Garnish.requestAnimationFrame(function() {\n                        // Scroll to the block\n                        Garnish.scrollContainerToElement($block);\n\n                        // Focus on the first text input\n                        $block.find('.text,[contenteditable]').first().trigger('focus');\n\n                        // Resume the draft editor\n                        if (window.draftEditor) {\n                            window.draftEditor.resume();\n                        }\n                    });\n                }, this));\n            },\n\n            getBlockTypeByHandle: function(handle) {\n                for (var i = 0; i < this.blockTypes.length; i++) {\n                    if (this.blockTypes[i].handle === handle) {\n                        return this.blockTypes[i];\n                    }\n                }\n            },\n\n            collapseSelectedBlocks: function() {\n                this.callOnSelectedBlocks('collapse');\n            },\n\n            expandSelectedBlocks: function() {\n                this.callOnSelectedBlocks('expand');\n            },\n\n            disableSelectedBlocks: function() {\n                this.callOnSelectedBlocks('disable');\n            },\n\n            enableSelectedBlocks: function() {\n                this.callOnSelectedBlocks('enable');\n            },\n\n            deleteSelectedBlocks: function() {\n                this.callOnSelectedBlocks('selfDestruct');\n            },\n\n            callOnSelectedBlocks: function(fn) {\n                for (var i = 0; i < this.blockSelect.$selectedItems.length; i++) {\n                    this.blockSelect.$selectedItems.eq(i).data('block')[fn]();\n                }\n            },\n\n            getHiddenBlockCss: function($block) {\n                return {\n                    opacity: 0,\n                    marginBottom: -($block.outerHeight())\n                };\n            },\n\n            getParsedBlockHtml: function(html, id) {\n                if (typeof html === 'string') {\n                    return html.replace(new RegExp(`__BLOCK_${this.settings.placeholderKey}__`, 'g'), id);\n                }\n                else {\n                    return '';\n                }\n            },\n\n            get maxBlocks() {\n                return this.settings.maxBlocks;\n            },\n        },\n        {\n            defaults: {\n                placeholderKey: null,\n                maxBlocks: null,\n                staticBlocks: false,\n            },\n\n            collapsedBlockStorageKey: 'Craft-' + Craft.systemUid + '.MatrixInput.collapsedBlocks',\n\n            getCollapsedBlockIds: function() {\n                if (typeof localStorage[Craft.MatrixInput.collapsedBlockStorageKey] === 'string') {\n                    return Craft.filterArray(localStorage[Craft.MatrixInput.collapsedBlockStorageKey].split(','));\n                }\n                else {\n                    return [];\n                }\n            },\n\n            setCollapsedBlockIds: function(ids) {\n                localStorage[Craft.MatrixInput.collapsedBlockStorageKey] = ids.join(',');\n            },\n\n            rememberCollapsedBlockId: function(id) {\n                if (typeof Storage !== 'undefined') {\n                    var collapsedBlocks = Craft.MatrixInput.getCollapsedBlockIds();\n\n                    if ($.inArray('' + id, collapsedBlocks) === -1) {\n                        collapsedBlocks.push(id);\n                        Craft.MatrixInput.setCollapsedBlockIds(collapsedBlocks);\n                    }\n                }\n            },\n\n            forgetCollapsedBlockId: function(id) {\n                if (typeof Storage !== 'undefined') {\n                    var collapsedBlocks = Craft.MatrixInput.getCollapsedBlockIds(),\n                        collapsedBlocksIndex = $.inArray('' + id, collapsedBlocks);\n\n                    if (collapsedBlocksIndex !== -1) {\n                        collapsedBlocks.splice(collapsedBlocksIndex, 1);\n                        Craft.MatrixInput.setCollapsedBlockIds(collapsedBlocks);\n                    }\n                }\n            }\n        });\n\n\n    var MatrixBlock = Garnish.Base.extend(\n        {\n            matrix: null,\n            $container: null,\n            $titlebar: null,\n            $fieldsContainer: null,\n            $previewContainer: null,\n            $actionMenu: null,\n            $collapsedInput: null,\n\n            isNew: null,\n            id: null,\n\n            collapsed: false,\n\n            init: function(matrix, $container) {\n                this.matrix = matrix;\n                this.$container = $container;\n                this.$titlebar = $container.children('.titlebar');\n                this.$previewContainer = this.$titlebar.children('.preview');\n                this.$fieldsContainer = $container.children('.fields');\n\n                this.$container.data('block', this);\n\n                this.id = this.$container.data('id');\n                this.isNew = (!this.id || (typeof this.id === 'string' && this.id.substr(0, 3) === 'new'));\n\n                var $menuBtn = this.$container.find('> .actions > .settings'),\n                    menuBtn = new Garnish.MenuBtn($menuBtn);\n\n                this.$actionMenu = menuBtn.menu.$container;\n\n                menuBtn.menu.settings.onOptionSelect = $.proxy(this, 'onMenuOptionSelect');\n\n                menuBtn.menu.on('show', () => {\n                    this.$container.addClass('active');\n                    if (this.$container.prev('.matrixblock').length) {\n                        this.$actionMenu.find('a[data-action=moveUp]:first').parent().removeClass('hidden');\n                    } else {\n                        this.$actionMenu.find('a[data-action=moveUp]:first').parent().addClass('hidden');\n                    }\n                    if (this.$container.next('.matrixblock').length) {\n                        this.$actionMenu.find('a[data-action=moveDown]:first').parent().removeClass('hidden');\n                    } else {\n                        this.$actionMenu.find('a[data-action=moveDown]:first').parent().addClass('hidden');\n                    }\n                });\n                menuBtn.menu.on('hide', () => {\n                    this.$container.removeClass('active');\n                });\n\n                // Was this block already collapsed?\n                if (Garnish.hasAttr(this.$container, 'data-collapsed')) {\n                    this.collapse();\n                }\n\n                this._handleTitleBarClick = function(ev) {\n                    ev.preventDefault();\n                    this.toggle();\n                };\n\n                this.addListener(this.$titlebar, 'doubletap', this._handleTitleBarClick);\n            },\n\n            toggle: function() {\n                if (this.collapsed) {\n                    this.expand();\n                }\n                else {\n                    this.collapse(true);\n                }\n            },\n\n            collapse: function(animate) {\n                if (this.collapsed) {\n                    return;\n                }\n\n                this.$container.addClass('collapsed');\n\n                var previewHtml = '',\n                    $fields = this.$fieldsContainer.children().children();\n\n                for (var i = 0; i < $fields.length; i++) {\n                    var $field = $($fields[i]),\n                        $inputs = $field.children('.input').find('select,input[type!=\"hidden\"],textarea,.label'),\n                        inputPreviewText = '';\n\n                    for (var j = 0; j < $inputs.length; j++) {\n                        var $input = $($inputs[j]),\n                            value;\n\n                        if ($input.hasClass('label')) {\n                            var $maybeLightswitchContainer = $input.parent().parent();\n\n                            if ($maybeLightswitchContainer.hasClass('lightswitch') && (\n                                    ($maybeLightswitchContainer.hasClass('on') && $input.hasClass('off')) ||\n                                    (!$maybeLightswitchContainer.hasClass('on') && $input.hasClass('on'))\n                                )) {\n                                continue;\n                            }\n\n                            value = $input.text();\n                        }\n                        else {\n                            value = Craft.getText(Garnish.getInputPostVal($input));\n                        }\n\n                        if (value instanceof Array) {\n                            value = value.join(', ');\n                        }\n\n                        if (value) {\n                            value = Craft.trim(value);\n\n                            if (value) {\n                                if (inputPreviewText) {\n                                    inputPreviewText += ', ';\n                                }\n\n                                inputPreviewText += value;\n                            }\n                        }\n                    }\n\n                    if (inputPreviewText) {\n                        previewHtml += (previewHtml ? ' <span>|</span> ' : '') + inputPreviewText;\n                    }\n                }\n\n                this.$previewContainer.html(previewHtml);\n\n                this.$fieldsContainer.velocity('stop');\n                this.$container.velocity('stop');\n\n                if (animate) {\n                    this.$fieldsContainer.velocity('fadeOut', {duration: 'fast'});\n                    this.$container.velocity({height: 16}, 'fast');\n                }\n                else {\n                    this.$previewContainer.show();\n                    this.$fieldsContainer.hide();\n                    this.$container.css({height: 16});\n                }\n\n                setTimeout($.proxy(function() {\n                    this.$actionMenu.find('a[data-action=collapse]:first').parent().addClass('hidden');\n                    this.$actionMenu.find('a[data-action=expand]:first').parent().removeClass('hidden');\n                }, this), 200);\n\n                // Remember that?\n                if (!this.isNew) {\n                    Craft.MatrixInput.rememberCollapsedBlockId(this.id);\n                }\n                else {\n                    if (!this.$collapsedInput) {\n                        this.$collapsedInput = $('<input type=\"hidden\" name=\"' + this.matrix.inputNamePrefix + '[blocks][' + this.id + '][collapsed]\" value=\"1\"/>').appendTo(this.$container);\n                    }\n                    else {\n                        this.$collapsedInput.val('1');\n                    }\n                }\n\n                this.collapsed = true;\n            },\n\n            expand: function() {\n                if (!this.collapsed) {\n                    return;\n                }\n\n                this.$container.removeClass('collapsed');\n\n                this.$fieldsContainer.velocity('stop');\n                this.$container.velocity('stop');\n\n                var collapsedContainerHeight = this.$container.height();\n                this.$container.height('auto');\n                this.$fieldsContainer.show();\n                var expandedContainerHeight = this.$container.height();\n                var displayValue = this.$fieldsContainer.css('display') || 'block';\n                this.$container.height(collapsedContainerHeight);\n                this.$fieldsContainer.hide().velocity('fadeIn', {duration: 'fast', display: displayValue});\n                this.$container.velocity({height: expandedContainerHeight}, 'fast', $.proxy(function() {\n                    this.$previewContainer.html('');\n                    this.$container.height('auto');\n                }, this));\n\n                setTimeout($.proxy(function() {\n                    this.$actionMenu.find('a[data-action=collapse]:first').parent().removeClass('hidden');\n                    this.$actionMenu.find('a[data-action=expand]:first').parent().addClass('hidden');\n                }, this), 200);\n\n                // Remember that?\n                if (!this.isNew && typeof Storage !== 'undefined') {\n                    var collapsedBlocks = Craft.MatrixInput.getCollapsedBlockIds(),\n                        collapsedBlocksIndex = $.inArray('' + this.id, collapsedBlocks);\n\n                    if (collapsedBlocksIndex !== -1) {\n                        collapsedBlocks.splice(collapsedBlocksIndex, 1);\n                        Craft.MatrixInput.setCollapsedBlockIds(collapsedBlocks);\n                    }\n                }\n\n                if (!this.isNew) {\n                    Craft.MatrixInput.forgetCollapsedBlockId(this.id);\n                }\n                else if (this.$collapsedInput) {\n                    this.$collapsedInput.val('');\n                }\n\n                this.collapsed = false;\n            },\n\n            disable: function() {\n                this.$container.children('input[name$=\"[enabled]\"]:first').val('');\n                this.$container.addClass('disabled');\n\n                setTimeout($.proxy(function() {\n                    this.$actionMenu.find('a[data-action=disable]:first').parent().addClass('hidden');\n                    this.$actionMenu.find('a[data-action=enable]:first').parent().removeClass('hidden');\n                }, this), 200);\n\n                this.collapse(true);\n            },\n\n            enable: function() {\n                this.$container.children('input[name$=\"[enabled]\"]:first').val('1');\n                this.$container.removeClass('disabled');\n\n                setTimeout($.proxy(function() {\n                    this.$actionMenu.find('a[data-action=disable]:first').parent().removeClass('hidden');\n                    this.$actionMenu.find('a[data-action=enable]:first').parent().addClass('hidden');\n                }, this), 200);\n            },\n\n            moveUp: function() {\n                let $prev = this.$container.prev('.matrixblock');\n                if ($prev.length) {\n                    this.$container.insertBefore($prev);\n                    this.matrix.blockSelect.resetItemOrder();\n                }\n            },\n\n            moveDown: function() {\n                let $next = this.$container.next('.matrixblock');\n                if ($next.length) {\n                    this.$container.insertAfter($next);\n                    this.matrix.blockSelect.resetItemOrder();\n                }\n            },\n\n            onMenuOptionSelect: function(option) {\n                var batchAction = (this.matrix.blockSelect.totalSelected > 1 && this.matrix.blockSelect.isSelected(this.$container)),\n                    $option = $(option);\n\n                switch ($option.data('action')) {\n                    case 'collapse': {\n                        if (batchAction) {\n                            this.matrix.collapseSelectedBlocks();\n                        }\n                        else {\n                            this.collapse(true);\n                        }\n\n                        break;\n                    }\n\n                    case 'expand': {\n                        if (batchAction) {\n                            this.matrix.expandSelectedBlocks();\n                        }\n                        else {\n                            this.expand();\n                        }\n\n                        break;\n                    }\n\n                    case 'disable': {\n                        if (batchAction) {\n                            this.matrix.disableSelectedBlocks();\n                        }\n                        else {\n                            this.disable();\n                        }\n\n                        break;\n                    }\n\n                    case 'enable': {\n                        if (batchAction) {\n                            this.matrix.enableSelectedBlocks();\n                        }\n                        else {\n                            this.enable();\n                            this.expand();\n                        }\n\n                        break;\n                    }\n\n                    case 'moveUp': {\n                        this.moveUp();\n                        break;\n                    }\n\n                    case 'moveDown': {\n                        this.moveDown();\n                        break;\n                    }\n\n                    case 'add': {\n                        var type = $option.data('type');\n                        this.matrix.addBlock(type, this.$container);\n                        break;\n                    }\n\n                    case 'delete': {\n                        if (batchAction) {\n                            if (confirm(Craft.t('app', 'Are you sure you want to delete the selected blocks?'))) {\n                                this.matrix.deleteSelectedBlocks();\n                            }\n                        }\n                        else {\n                            this.selfDestruct();\n                        }\n\n                        break;\n                    }\n                }\n            },\n\n            selfDestruct: function() {\n                // Pause the draft editor\n                if (window.draftEditor) {\n                    window.draftEditor.pause();\n                }\n\n                this.$container.velocity(this.matrix.getHiddenBlockCss(this.$container), 'fast', $.proxy(function() {\n                    this.$container.remove();\n                    this.matrix.updateAddBlockBtn();\n\n                    // Resume the draft editor\n                    if (window.draftEditor) {\n                        window.draftEditor.resume();\n                    }\n                }, this));\n\n                this.matrix.trigger('blockDeleted', {\n                    $block: this.$container,\n                });\n            }\n        });\n})(jQuery);\n"]}