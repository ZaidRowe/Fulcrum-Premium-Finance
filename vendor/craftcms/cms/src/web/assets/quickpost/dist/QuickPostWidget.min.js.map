{"version":3,"sources":["quickpost/src/QuickPostWidget.js"],"names":["$","Craft","QuickPostWidget","Garnish","Base","extend","params","initFields","$widget","$form","$formClone","$spinner","$errorList","loading","widgetId","this","find","initForm","clone","$menuBtn","$saveAndContinueEditingBtn","next","addListener","menubtn","saveAndContinueEditing","proxy","handleFormSubmit","event","preventDefault","save","formData","getPostData","postActionRequest","children","removeClass","textStatus","response","success","enabled","callback","data","displayError","errors","remove","attribute","hasOwnProperty","cp","length","error","insertAfter","i","appendTo","widget","title","username","authorUsername","replaceWith","$newForm","RecentEntriesWidget","instances","cpEditUrl","sectionId","addEntry","url","dateCreated","gotoEntry","redirectTo","jQuery"],"mappings":"CAAA,SAACA,GAEGC,MAAAC,gBAAAC,QAAAC,KAAAC,OACMH,CAEUI,OADZ,KAEIC,WAFJ,KAGWC,QAHX,KAIWC,MAJX,KAKIC,WALJ,KAMYC,SANZ,KAOIC,WAPJ,KAQWC,SARX,EAWaP,KAAL,SAAAQ,EAAAR,EAAAC,GACKA,KAALD,OAAkBC,EACbC,KAAUR,WAAEO,EAERQ,KAAGP,QAAaQ,EAAAA,UAAKF,GAEzBG,IAASR,EAAdM,KAAAP,QAAAQ,KAAA,cAjBRD,KAAAL,WAAAD,EAAAS,QAoBcH,KAAAE,SAAAR,IAIDF,SAAL,SAAAE,GAEIU,KAAWV,MAAKA,EAChBW,KAAAA,SAAAA,KAA0BX,MAAGU,KAASE,YAIrCC,KAAAA,aA/Bb,IAAAH,EAAAJ,KAAAN,MAAAO,KAAA,qCAmCoBI,EAAkBD,EAAAE,OAAAL,KAAA,iBAGpBhB,EAAQuB,UAGtBC,KAAAA,YAAwBT,KAAAN,MAAW,SAAA,oBACrBT,KAAEyB,YAAYL,EAAxB,QAAA,2BAIIM,iBAAc,SAAAC,GACdA,EAAAC,iBATJb,KAAKc,KAAK7B,EAAEyB,MAAMV,KAAM,YAepBe,uBAAmBC,WACfhB,KAAKV,KAAOL,EAAAyB,MAAAV,KAAA,eAEdiB,KAAAA,SAAAA,GACGnB,IAALE,KAAeF,QAAVA,CAIID,KAAAA,SAAWqB,EACnBlB,KAAAJ,SAAAuB,YAAA,UAEGC,IAAAA,EAAehC,QAAW4B,YAAAhB,KAAAN,OACtB2B,EAASC,EAAAA,OAAS,CAAAC,QAAA,GAAAR,EAAAf,KAAAT,QAElBiC,MAASH,kBAAT,qBAAAI,EAAAxC,EAAAyB,OAAA,SAAAW,EAAAD,GAHR,GAKSpB,KAAAF,SAAA,EACDE,KAAS0B,SAAaxC,SAAQ,UAElBc,KAAC2B,YACC9B,KAAAA,WAAYqB,WAAAU,SATf,YAAfR,EAaiBS,GAAAA,EAAaR,QACbA,MAASM,GAAOG,cAAhB5C,MAA+B2C,EAAAA,MAAY,iBAC5CL,EAAAH,QAKE,GAFInC,MAAO6C,GAAGV,aAASM,MAAOE,EAAAA,MAAWG,yBAEhCC,EAAQN,OAKtC,IAAA,IAAAE,KAJgB7B,KAAAH,aACJG,KAAAH,WAAAZ,EAAA,wBAAAiD,YAAAlC,KAAAN,QAGZ2B,EAAAM,OAjCL,GAAAN,EAAAM,OAAAG,eAAAD,GAuCe,IAAgB1B,IAA/BgC,EAAA,EAAAA,EAAAd,EAAAM,OAAAE,GAAAG,OAAAG,IAAA,CACA,IAAAF,EAAAZ,EAAAM,OAAAE,GAAAM,GAGAlD,EAAA,OAAAgD,EAAA,SAAAG,SAAApC,KAAAH,eAIawC,SAGGC,OAAK,SAAUjB,GAEfkB,IAAAA,EAAUlB,KAASmB,WAAAA,QA5G3C,GAwGoBxC,KAAAN,MAAA+C,YAAAC,GAMH1C,KAAAE,SAAAwC,QA9GjB,IAAAxD,MAAAyD,oBAmHe,IAAStB,IAAAA,EAAT,EAAmBc,EAAAjD,MAAAyD,oBAAAC,UAAAZ,OAAAG,IAAA,CAC1B,IAAAE,EAAAnD,MAAAyD,oBAAAC,UAAAT,GACiBd,EAASwB,OAA1BC,WAAAT,EAAA9C,OAAAuD,WAAA9C,KAAAT,OAAAuD,WACHT,EAAAU,SAAA,CAvHTC,IAAA3B,EAAAwB,UAHJP,MAAAjB,EAAAiB,MA+GgCW,YAAa5B,EAAS4B,YACtBV,SAAUlB,EAASmB,mBAOvCU,UAAW,SAAS7B,GAEhBnC,MAAMiE,WAAW9B,EAASwB,cAzH1C,CA4HGO","file":"QuickPostWidget.min.js","sourcesContent":["(function($) {\n    /** global: Craft */\n    /** global: Garnish */\n    Craft.QuickPostWidget = Garnish.Base.extend(\n        {\n            params: null,\n            initFields: null,\n            $widget: null,\n            $form: null,\n            $formClone: null,\n            $spinner: null,\n            $errorList: null,\n            loading: false,\n\n            init: function(widgetId, params, initFields) {\n                this.params = params;\n                this.initFields = initFields;\n                this.$widget = $('#widget' + widgetId);\n\n                var $form = this.$widget.find('form:first');\n                this.$formClone = $form.clone();\n                this.initForm($form);\n            },\n\n            initForm: function($form) {\n                this.$form = $form;\n                this.$spinner = this.$form.find('.spinner');\n\n                this.initFields();\n\n                var $menuBtn = this.$form.find('> .buttons > .btngroup > .menubtn'),\n                    $saveAndContinueEditingBtn = $menuBtn.next().find('> ul > li > a');\n\n                $menuBtn.menubtn();\n\n                this.addListener(this.$form, 'submit', 'handleFormSubmit');\n                this.addListener($saveAndContinueEditingBtn, 'click', 'saveAndContinueEditing');\n            },\n\n            handleFormSubmit: function(event) {\n                event.preventDefault();\n\n                this.save($.proxy(this, 'onSave'));\n            },\n\n            saveAndContinueEditing: function() {\n                this.save($.proxy(this, 'gotoEntry'));\n            },\n\n            save: function(callback) {\n                if (this.loading) {\n                    return;\n                }\n\n                this.loading = true;\n                this.$spinner.removeClass('hidden');\n\n                var formData = Garnish.getPostData(this.$form),\n                    data = $.extend({enabled: 1}, formData, this.params);\n\n                Craft.postActionRequest('entries/save-entry', data, $.proxy(function(response, textStatus) {\n                    this.loading = false;\n                    this.$spinner.addClass('hidden');\n\n                    if (this.$errorList) {\n                        this.$errorList.children().remove();\n                    }\n\n                    if (textStatus === 'success') {\n                        if (response.success) {\n                            Craft.cp.displayNotice(Craft.t('app', 'Entry saved.'));\n                            callback(response);\n                        }\n                        else {\n                            Craft.cp.displayError(Craft.t('app', 'Couldnâ€™t save entry.'));\n\n                            if (response.errors) {\n                                if (!this.$errorList) {\n                                    this.$errorList = $('<ul class=\"errors\"/>').insertAfter(this.$form);\n                                }\n\n                                for (var attribute in response.errors) {\n                                    if (!response.errors.hasOwnProperty(attribute)) {\n                                        continue;\n                                    }\n\n                                    for (var i = 0; i < response.errors[attribute].length; i++) {\n                                        var error = response.errors[attribute][i];\n                                        $('<li>' + error + '</li>').appendTo(this.$errorList);\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }, this));\n            },\n\n            onSave: function(response) {\n                // Reset the widget\n                var $newForm = this.$formClone.clone();\n                this.$form.replaceWith($newForm);\n                this.initForm($newForm);\n\n                // Are there any Recent Entries widgets to notify?\n                if (typeof Craft.RecentEntriesWidget !== 'undefined') {\n                    for (var i = 0; i < Craft.RecentEntriesWidget.instances.length; i++) {\n                        var widget = Craft.RecentEntriesWidget.instances[i];\n                        if (!widget.params.sectionId || widget.params.sectionId == this.params.sectionId) {\n                            widget.addEntry({\n                                url: response.cpEditUrl,\n                                title: response.title,\n                                dateCreated: response.dateCreated,\n                                username: response.authorUsername\n                            });\n                        }\n                    }\n                }\n            },\n\n            gotoEntry: function(response) {\n                // Redirect to the entry's edit URL\n                Craft.redirectTo(response.cpEditUrl);\n            }\n        });\n})(jQuery);\n"]}