{"version":3,"sources":["properties/properties.js"],"names":["$R","add","modals","properties","translations","en","init","app","this","opts","lang","$body","toolbar","inspector","selection","labelStyle","font-family","position","padding","line-height","border-radius","font-size","color","onmodal","open","$modal","$form","$block","blockData","_getData","setData","opened","getField","focus","save","data","getData","_save","onbutton","observe","button","_observeButton","start","title","get","api","addButton","setIcon","_createLabel","stop","_removeLabel","block","getBlock","dom","options","width","name","handle","commands","cancel","id","removeAttr","attr","classname","_showData","str","pos","offset","$label","css","top","left","z-index","zindex","html","show","hide","append","remove","parse","isComponent","enable","disable","Redactor"],"mappings":"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","file":"properties.js","sourcesContent":["(function($R)\n{\n    $R.add('plugin', 'properties', {\n        modals: {\n            'properties':\n                '<form action=\"\"> \\\n                    <div class=\"form-item\"> \\\n                        <label>Id</label> \\\n                        <input type=\"text\" name=\"id\"> \\\n                    </div> \\\n                    <div class=\"form-item\"> \\\n                        <label>Class</label> \\\n                        <input type=\"text\" name=\"classname\"> \\\n                    </div> \\\n                </form>'\n        },\n        translations: {\n    \t\ten: {\n    \t\t\t\"properties\": \"Properties\"\n    \t\t}\n        },\n        init: function(app)\n        {\n            this.app = app;\n            this.opts = app.opts;\n            this.lang = app.lang;\n            this.$body = app.$body;\n            this.toolbar = app.toolbar;\n            this.inspector = app.inspector;\n            this.selection = app.selection;\n\n            // local\n    \t\tthis.labelStyle = {\n        \t\t'font-family': 'monospace',\n    \t\t\t'position': 'absolute',\n    \t\t\t'padding': '2px 5px',\n    \t\t\t'line-height': 1,\n    \t\t\t'border-radius': '3px',\n    \t\t\t'font-size': '11px',\n    \t\t\t'color': 'rgba(255, 255, 255, .9)'\n    \t\t};\n        },\n        // messages\n        onmodal: {\n            properties: {\n                open: function($modal, $form)\n                {\n                    if (this.$block)\n                    {\n                        var blockData = this._getData(this.$block);\n                        $form.setData(blockData);\n                    }\n                },\n                opened: function($modal, $form)\n                {\n                    $form.getField('id').focus();\n                },\n                save: function($modal, $form)\n                {\n                    var data = $form.getData();\n                    this._save(data);\n                }\n            }\n        },\n        onbutton: {\n            properties: {\n                observe: function(button)\n                {\n                    this._observeButton(button);\n                }\n            }\n        },\n\n        // public\n        start: function()\n        {\n            var data = {\n                title: this.lang.get('properties'),\n                api: 'plugin.properties.open',\n                observe: 'properties'\n            };\n\n            var $button = this.toolbar.addButton('properties', data);\n            $button.setIcon('<i class=\"re-icon-properties\"></i>');\n\n            this._createLabel();\n        },\n        stop: function()\n        {\n            this._removeLabel();\n        },\n        open: function()\n\t\t{\n           var block = this.selection.getBlock();\n           if (!block) return;\n\n           this.$block = $R.dom(block);\n\n           var options = {\n                title: this.lang.get('properties'),\n                width: '500px',\n                name: 'properties',\n                handle: 'save',\n                commands: {\n                    save: { title: this.lang.get('save') },\n                    cancel: { title: this.lang.get('cancel') }\n                }\n            };\n\n            this.app.api('module.modal.build', options);\n\t\t},\n\n\t\t// private\n\t\t_save: function(data)\n\t\t{\n    \t\tthis.app.api('module.modal.close');\n\n    \t\tif (data.id === '') this.$block.removeAttr('id');\n    \t\telse this.$block.attr('id', data.id);\n\n    \t\tif (data.classname === '') this.$block.removeAttr('class');\n    \t\telse this.$block.attr('class', data.classname);\n\t\t},\n\t\t_getData: function(block)\n\t\t{\n    \t    var $block = $R.dom(block);\n    \t    var data = {\n        \t    id: $block.attr('id'),\n        \t    classname: $block.attr('class')\n    \t    };\n\n    \t    return data;\n\t\t},\n\t\t_showData: function(block, data)\n\t\t{\n    \t\tvar str = '';\n    \t\tif (data.id) str += '#' + data.id + ' ';\n    \t\tif (data.classname) str += '.' + data.classname;\n\n\n            if (str !== '')\n            {\n                var $block = $R.dom(block);\n                var pos = $block.offset();\n\n                this.$label.css({\n                    top: (pos.top - 12) + 'px',\n                    left: pos.left + 'px',\n                    'z-index': (this.opts.zindex) ? (this.opts.zindex + 3) : 'auto'\n                });\n                this.$label.html(str);\n                this.$label.show();\n            }\n            else\n            {\n                this.$label.hide();\n            }\n\t\t},\n\t\t_createLabel: function()\n\t\t{\n            this.$label = $R.dom('<span />');\n            this.$label.hide();\n\t\t\tthis.$label.css(this.labelStyle).css('background', 'rgba(229, 57, 143, .7)');\n\n\t\t\tthis.$body.append(this.$label);\n\t\t},\n\t\t_removeLabel: function()\n\t\t{\n            if (this.$label) this.$label.remove();\n\t\t},\n\t\t_observeButton: function(button)\n\t\t{\n    \t\tvar block = this.selection.getBlock();\n    \t\tvar data = this.inspector.parse(block);\n\n    \t\tif (block && !data.isComponent())\n    \t\t{\n        \t\tvar blockData = this._getData(block);\n\n                this._showData(block, blockData);\n        \t    button.enable();\n    \t\t}\n    \t\telse\n    \t\t{\n        \t    button.disable();\n        \t    if (this.$label) this.$label.hide();\n    \t\t}\n\t\t}\n    });\n})(Redactor);"]}