var imageResizeClass=$R.classes["image.resize"];imageResizeClass.prototype.init=function(t){this.app=t,this.$doc=t.$doc,this.$win=t.$win,this.$body=t.$body,this.editor=t.editor,this.toolbar=t.toolbar,this.inspector=t.inspector,this.$target=this.toolbar.isTarget()?this.toolbar.getTargetElement():this.$body;attachPreviewListeners(()=>{this.hide();var t=$(".lp-editor");t.length&&(this.$target=$R.dom(t[0]))},()=>{this.hide(),this.$target=this.toolbar.isTarget()?this.toolbar.getTargetElement():this.$body}),this._init()},imageResizeClass.prototype._setResizerPosition=function(){if(this.$resizer){var t=this.toolbar.isTarget(),e=this.$target.offset(),i=t?7-e.top+this.$target.scrollTop():7,s=t?7-e.left:7,o=this.$resizableImage.offset(),r=this.$resizableImage.width(),a=this.$resizableImage.height(),h=this.$resizer.width(),l=this.$resizer.height();this.$resizer.css({top:Math.round(o.top+a-l+i)+"px",left:Math.round(o.left+r-h+s)+"px"})}},imageResizeClass.prototype._build=function(t){this.$target.find("#redactor-image-resizer").remove();var e=this.inspector.parse(t.target),i=this.editor.getElement();e.isComponentType("image")&&(this.$resizableBox=i,this.$resizableImage=$R.dom(e.getImageElement()),this.$resizer=$R.dom("<span>"),this.$resizer.attr("id","redactor-image-resizer"),this.$resizer.css({"z-index":100}),this.$target.append(this.$resizer),this._setResizerPosition(),this.$resizer.on("mousedown touchstart",this._set.bind(this)))},imageResizeClass.prototype.hide=function(){this.$target.find("#redactor-image-resizer").remove(),this.toolbar.isTarget()?this.$target.off("scroll.resizer",this.rebuild.bind(this)):$R.dom("#content-container").off("scroll.resizer",this.rebuild.bind(this))};var toolbarFixedClass=$R.classes["toolbar.fixed"];toolbarFixedClass.prototype.livePreview=!1,toolbarFixedClass.prototype.$previousFixedTarget=!1,toolbarFixedClass.prototype._init=function(){this.$fixedTarget=this.toolbar.isTarget()?this.toolbar.getTargetElement():this.$win,this._doFixed(),this.toolbar.isTarget()&&(this.$win.on("scroll.redactor-toolbar-"+this.uuid,this._doFixed.bind(this)),this.$win.on("resize.redactor-toolbar-"+this.uuid,this._doFixed.bind(this))),this.$fixedTarget.on("scroll.redactor-toolbar-"+this.uuid,this._doFixed.bind(this)),this.$fixedTarget.on("resize.redactor-toolbar-"+this.uuid,this._doFixed.bind(this));attachPreviewListeners(()=>{var t=$(".lp-editor");t.length&&(this.livePreview=!0,this.$previousFixedTarget=this.$fixedTarget,(t=$R.dom(t[0])).on("scroll.redactor-toolbar-"+this.uuid,this._doFixed.bind(this)),this.$fixedTarget=t)},()=>{this.livePreview=!1,this.$fixedTarget=this.$previousFixedTarget,this.$previousFixedTarget=null})},toolbarFixedClass.prototype._doFixed=function(){var t=this.editor.getElement(),e=this.container.getElement(),i=this.toolbar.getElement(),s=this.toolbar.getWrapper();if(!this.editor.isSourceMode()&&0===e.parents().filter((function(t){return"none"===getComputedStyle(t,null).display&&t})).length){var o=t.height()<100,r=this.editor.isEmpty();if(o||r)this.reset();else{var a,h=i.height(),l=0;if(this.livePreview)var n=$(".lp-editor-container header.flex").length?$(".lp-editor-container header.flex").outerHeight():0,d=(p=t.offset().top-n)+t.height()-h;else{var p;n=$("body.fixed-header #header").length?$("body.fixed-header #header").outerHeight():0,d=(p=t.offset().top-this.$win.scrollTop()-n)+t.height()-h}if(a=p+20<0&&d>0,l=t.scrollTop()+n,a){var g=this.detector.isDesktop()?"fixed":"absolute";l=this.detector.isDesktop()?l:scrollOffset-boxOffset+this.opts.toolbarFixedTopOffset,this.detector.isMobile()&&(this.fixedScrollTimeout&&clearTimeout(this.fixedScrollTimeout),i.hide(),this.fixedScrollTimeout=setTimeout((function(){i.show()}),250)),s.height(h),i.addClass("redactor-toolbar-fixed"),i.css({position:g,top:l+this.opts.toolbarFixedTopOffset+"px",width:e.width()+"px"});var c=this.toolbar.getDropdown();c&&c.updatePosition(),this.app.broadcast("toolbar.fixed")}else this.reset(),this.app.broadcast("toolbar.unfixed")}}};var inputCleanerService=$R.services.cleaner;inputCleanerService.prototype.input=function(t,e,i){t=(t=(t=this.encodeCode(t)).replace(/\$/g,"&#36;")).replace(/&amp;/g,"&"),t=$R.create("cleaner.figure",this.app).convert(t,this.convertRules),t=this.storeComponents(t),t=this.replaceTags(t,this.opts.replaceTags),t=this._setSpanAttr(t),t=this._setStyleCache(t),t=this.removeTags(t,this.deniedTags),t=this.opts.removeScript?this._removeScriptTag(t):this._replaceScriptTag(t),t=this.opts.removeComments?this.removeComments(t):t,t=this._isSpacedEmpty(t)?this.opts.emptyHtml:t,t=this.restoreComponents(t),t=this._cleanWrapped(t);var s=this.utils.buildWrapper(t),o=["alt","title","src","class","width","height","srcset","style"];return s.find("img").each((function(t){if(t.attributes.length>0)for(var e=t.attributes,i=e.length-1;i>=0;i--)-1===e[i].name.search(/^data\-/)&&-1===o.indexOf(e[i].name)&&t.removeAttribute(e[i].name)})),t=this.utils.getWrapperHtml(s),t=e?this.paragraphize(t):t};var toolbarDropdownClass=$R.classes["toolbar.dropdown"];toolbarDropdownClass.prototype.updatePosition=function(){var t=this.toolbar.isFixed(),e=this.toolbar.isTarget(),i=this.$btn.height(),s=this.$btn.width(),o=this.$btn.offset(),r="absolute",a=2;t&&(o.top=e?this.$btn.offset().top:this.$btn.position().top,r="fixed",a+=this.opts.toolbarFixedTopOffset);var h=o.left+0,l=parseFloat(this.css("width")),n=h-(this.$win.width()<h+l?l-s:0),d=o.top+i+a;if(t){var p=this.toolbar.getElement();d=p.position().top+p.height()}n=n<0?4:n,this.css({maxHeight:"",position:r,top:d+"px",left:n+"px"});var g=this.$win.height()-(d-this.$doc.scrollTop())-10;this.css("max-height",g+"px")};var contextBarClass=$R.modules.contextbar;function attachPreviewListeners(t,e){Garnish.on(Craft.Preview,"open",t),Garnish.on(Craft.LivePreview,"enter",t),Garnish.on(Craft.Preview,"close",e),Garnish.on(Craft.LivePreview,"exit",e)}contextBarClass.prototype.init=function(t){this.app=t,this.opts=t.opts,this.uuid=t.uuid,this.$win=t.$win,this.$doc=t.$doc,this.$body=t.$body,this.editor=t.editor,this.toolbar=t.toolbar,this.detector=t.detector,this.livePreview=!1,this.$target=this.toolbar.isTarget()?this.toolbar.getTargetElement():this.$body;attachPreviewListeners(()=>{var t=$(".lp-editor");t.length&&($(this.$contextbar.get()).appendTo(t),this.livePreview=!0)},()=>{$target=$(this.toolbar.isTarget()?this.toolbar.getTargetElement():this.$body),$(this.$contextbar.get()).appendTo($target.get(0)),this.livePreview=!1})};
//# sourceMappingURL=RedactorOverrides.min.js.map
